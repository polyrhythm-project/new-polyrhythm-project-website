{% comment %}
//
// Programmer:    Craig Stuart Sapp <craig@ccrma.stanford.edu>
// Creation Date: Mon May 13 15:33:16 PDT 2024
// Last Modified: Mon May 13 15:33:19 PDT 2024
// Filename:      composers/listeners.html
// vim:           set ts=3 nowrap ft=liquid:
//
// Description:   Setup javascript code for composers webpage.  Contains
//                global variable and listeners for the page.
//
{% endcomment %}


<script>

var CGI        = {};      // CGI parameters from URL
var WORKLIST   = [];
var SORTCOLUMN = 0;
var SORTORDER  = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];


//////////////////////////////
//
// DOMContentLoaded event listener --
//

document.addEventListener("DOMContentLoaded", function () {
	document.body.style.cursor = "wait";
	CGI = GetCgiParameters();

	// Create URL for metadata index to download:
	var mid = "AKfycbx0xaN18M80zNffypQ0F6yD-Wp1fh3bSIlgbyPWb6XkaGNNGhKeyJ__7YYgxCoBHOHWHw";
	var url = `https://script.google.com/macros/s/${mid}/exec`;
console.log("GOT HERE MMM");

	if (sessionStorage.EXAMPLELIST) {
console.log("GOT HERE RRR");
		EXAMPLELIST = JSON.parse(sessionStorage.EXAMPLELIST);
		doAction(EXAMPLELIST);
	} else {
		var request = new XMLHttpRequest();
		request.addEventListener("load", function () {
console.log("GOT HERE QQQ");
			EXAMPLELIST = ParseJsonSpreadsheet(this.responseText);
			sessionStorage.EXAMPLELIST = JSON.stringify(EXAMPLELIST);
			doAction(EXAMPLELIST);
		});
		request.open("GET", url);
		request.send();
	}
});



//////////////////////////////
//
// doAction --
//

function doAction(examplelist) {
	WORKLIST = GenerateWorklist(examplelist);
	displayComposerList();
	document.body.style.cursor = "";
}



</script>
