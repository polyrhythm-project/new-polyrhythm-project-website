

<script>
// vim: ts=3:nowrap

//////////////////////////////
//
// displayExampleStartTsigTypeRds --
//

function displayExampleStartTsigTypeRds() {
	let selector = document.querySelector("#ExampleStartTsigTypeRds");
	if (!selector) {
		console.warn("Cannot find #ExampleStartTsigTypeRds");
		return;
	}
	let data = {};
	for (let i=0; i<EXAMPLELIST.length; i++) {
		let dataset = EXAMPLELIST[i][INDEX_Example_Dataset];
		if (!dataset.match(/^R/)) {
			continue;
		}
		let value = EXAMPLELIST[i][INDEX_Example_Start_Tsig_Type];
		if (data[value]) {
			data[value]++;
		} else {
			data[value] = 1;
		}
	}

	let vdata = [];
	let keys = Object.keys(data).sort();
	for (let i=0; i<keys.length; i++) {
		let entry = {"name": keys[i], "y": data[keys[i]]};
		vdata.push(entry);
	}

	Highcharts.chart('ExampleStartTsigTypeRds', {
		chart: { type: 'pie' },
		title: { text: null },
		credits: { enabled: false },
		tooltip: { pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>' },
		accessibility: { point: { valueSuffix: '%' } },
		plotOptions: {
			pie: {
				allowPointSelect: true,
				cursor: 'pointer',
				dataLabels: {
					enabled: true,
					format: '<b>{point.name}</b>: {point.percentage:.1f} %',
					connectorColor: 'silver',
					style: {
						color: 'black',
						textOutline: 'none'
					}
				}
			}
		},
		series: [{ name: 'Share', data: vdata }]
	});

}



//////////////////////////////
//
// displayExampleStartTsigTypeTds --
//

function displayExampleStartTsigTypeTds() {
	let selector = document.querySelector("#ExampleStartTsigTypeTds");
	if (!selector) {
		console.warn("Cannot find #ExampleStartTsigTypeTds");
		return;
	}
	let data = {};
	for (let i=0; i<EXAMPLELIST.length; i++) {
		let dataset = EXAMPLELIST[i][INDEX_Example_Dataset];
		if (!dataset.match(/^T/)) {
			continue;
		}
		let value = EXAMPLELIST[i][INDEX_Example_Start_Tsig_Type];
		if (data[value]) {
			data[value]++;
		} else {
			data[value] = 1;
		}
	}

	let vdata = [];
	let keys = Object.keys(data).sort();
	for (let i=0; i<keys.length; i++) {
		let entry = {"name": keys[i], "y": data[keys[i]]};
		vdata.push(entry);
	}

	Highcharts.chart('ExampleStartTsigTypeTds', {
		chart: { type: 'pie' },
		title: { text: null },
		credits: { enabled: false },
		tooltip: { pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>' },
		accessibility: { point: { valueSuffix: '%' } },
		plotOptions: {
			pie: {
				allowPointSelect: true,
				cursor: 'pointer',
				dataLabels: {
					enabled: true,
					format: '<b>{point.name}</b>: {point.percentage:.1f} %',
					connectorColor: 'silver',
					style: {
						color: 'black',
						textOutline: 'none'
					}
				}
			}
		},
		series: [{ name: 'Share', data: vdata }]
	});

}



//////////////////////////////
//
// displayPolymetricCategories --
//

function displayPolymetricCategories() {
	let selector = document.querySelector("#PolymetricCategories");
	if (!selector) {
		console.warn("Cannot find #PolymetricCategories");
		return;
	}
	let data = {};
	for (let i=0; i<EXAMPLELIST.length; i++) {
		let tsigType = EXAMPLELIST[i][INDEX_Example_Start_Tsig_Type];
		if (!tsigType) {
			continue;
		}
		if (!tsigType.match(/poly/, "i")) {
			continue;
		}
		let poly = EXAMPLELIST[i][INDEX_Example_Start_Tsig];
		if (!poly.match(/[=;]/)) {
			console.log("REJECTING", poly);
			continue;
		}
		if (poly.match(/[+]/)) {
			console.log("REJECTING", poly);
			continue;
		}
		let matches = poly.match(/(.*\d)\(\d+\/\d+\)(;.*)/);
		if (matches) {
			poly = `${matches[1]}${matches[2]}`;
		}
		poly = poly.replace(/[(){}]/g, "");
		poly = poly.replace(/'\d+\/\d+\s*($|;)/g, ";");
		poly = poly.replace(/\s*;\s*/g, ";");
		poly = poly.replace(/\s*;$/, "");
		let pieces = poly.split(/;/);
		if (pieces.length == 2) {
			// Flip order to merge similar polymeters:
			if (pieces.length == 2) {
				matches = pieces[0].match(/^(\d+)\/(\d+)$/);
				if (matches) {
					let top1 = matches[1];
					let bot1 = matches[2];
					matches = pieces[1].match(/^(\d+)\/(\d+)$/);
					if (matches) {
						let top2 = matches[1];
						let bot2 = matches[2];
						if (top2 < top1) {
							poly = `${top2}/${bot2};${top1}/${bot1}`;
						}
					}
				}
			}
		}
	
		if (data[poly]) {
			data[poly]++;
		} else {
			data[poly] = 1;
		}
	}

	let vdata = [];
	let keys = Object.keys(data).sort();
	for (let i=0; i<keys.length; i++) {
		let entry = {"name": keys[i], "y": data[keys[i]]};
		vdata.push(entry);
	}

	Highcharts.chart('PolymetricCategories', {
		chart: { type: 'pie' },
		title: { text: null },
		credits: { enabled: false },
		tooltip: { pointFormat: '{series.name}: <b>{point.y}</b>' },
		accessibility: { point: { valueSuffix: '' } },
		plotOptions: {
			pie: {
				allowPointSelect: true,
				cursor: 'pointer',
				dataLabels: {
					enabled: true,
					format: '<b>{point.name}</b>: {point.y}',
					connectorColor: 'silver',
					style: {
						color: 'black',
						textOutline: 'none'
					}
				}
			}
		},
		series: [{ name: 'Count', data: vdata }]
	});
}



//////////////////////////////
//
// displayCountryCityTable --
//

function displayContryCityTable() {
	let element = document.querySelector("#country-city-table");
	if (!element) {
		console.warn("Cannot find #country-city-table");
	}
	let cities = [];
	let countries = [];
	let keys = Object.keys(WORKINDEX);
	for (let i=0; i<keys.length; i++) {
		let city = WORKINDEX[keys[i]][0][INDEX_Premiere_Location];
		city = city.replace(/,\s*/g, ", ");
		cities.push(city);
		let matches = city.match(/,\s*([^,]*)\s*$/);
		if (matches) {
			let country = matches[1];
			countries.push(country);
		}
	}

	let rcities = {};
	for (let i=0; i<cities.length; i++) {
		if (rcities[cities[i]]) {
			rcities[cities[i]]++;
		} else {
			rcities[cities[i]] = 1;
		}
	}

	let rcountries = {};
	for (let i=0; i<countries.length; i++) {
		if (rcountries[countries[i]]) {
			rcountries[countries[i]]++;
		} else {
			rcountries[countries[i]] = 1;
		}
	}

	let entries = Object.entries(rcities);
	entries.sort(([, value1], [, value2]) => value2 - value1);
	entries.sort(([key1, value1], [key2, value2]) => {
		if (value2 !== value1) {
			return value2 - value1;
		} else {
			return key1.localeCompare(key2);
		}
	});
	rcities = Object.fromEntries(entries);

	entries = Object.entries(rcountries);
	entries.sort(([key1, value1], [key2, value2]) => {
		if (value2 !== value1) {
			return value2 - value1;
		} else {
			return key1.localeCompare(key2);
		}
	});
	rcountries = Object.fromEntries(entries);

	console.warn("RCITIES", rcities);
	console.warn("RCOUNTRIES", rcountries);

	let output = "";
	output += `<table class="dual">`;
	output += "<tr><td>";


	keys = Object.keys(rcountries);
	output += `<div class="counting">${keys.length} countries:</div>`;
	output += `<table class="country">`;
	output += "<tr><th>Count</th><th>Country</th></tr>";
	for (let i=0; i<keys.length; i++) {
		output += "<tr>";
		output += `<td>${rcountries[keys[i]]}</td>`;
		output += `<td>${keys[i]}</td>`;
		output += "</tr>";
	}
	output += "</table>";


	output += "</td><td>";

	keys = Object.keys(rcities);
	output += `<div class="counting">${keys.length} cities:</div>`;
	output += `<table class="city">`;
	output += "<tr><th>Count</th><th>City</th></tr>";
	for (let i=0; i<keys.length; i++) {
		output += "<tr>";
		output += `<td>${rcities[keys[i]]}</td>`;
		output += `<td>${keys[i]}</td>`;
		output += "</tr>";
	}
	output += "</table>";


	output += "</td></tr>";
	output += "<table>";

	element.innerHTML = output;

}



//////////////////////////////
//
// displayExampleByComposers --
//

function displayExampleByComposers() {
	let data = {};
	for (let i=0; i<EXAMPLELIST.length; i++) {
		let composer = GetComposerLastName(EXAMPLELIST[i][INDEX_Composer_Name]);
		if (data[composer]) {
			data[composer]++;
		} else {
			data[composer] = 1;
		}
	}

	let vdata = [];
	let keys = Object.keys(data).sort();
	for (let i=0; i<keys.length; i++) {
		let entry = [ keys[i], data[keys[i]] ];
		vdata.push(entry);
	}

console.log("VDATA", vdata);

	var colors = [
		'#FF4500', '#FF6347', '#FF8C00', '#FF4500', '#CD5C5C', // Reds and Oranges
		'#8B0000', '#B22222', '#228B22', '#32CD32', '#008000', // Greens
		'#006400', '#ADFF2F', '#00FF7F', '#2E8B57', '#3CB371', // More Greens
		'#0000CD', '#00008B', '#4169E1', '#4682B4', '#5F9EA0', // Blues
		'#6495ED', '#6A5ACD', '#7B68EE', '#8A2BE2', '#4B0082', // More Blues
		'#9932CC', '#8B008B', '#800080', '#9370DB', '#9400D3', // Purples
		'#BA55D3', '#DA70D6', '#EE82EE', '#DDA0DD', '#FF00FF', // More Purples
	];

	let id = "ExamplesByComposers";
	WordCloud(document.getElementById(id), {
		list: vdata,
		gridSize: Math.round(16 * document.getElementById(id).offsetWidth / 1024),
		weightFactor: function (size) {
			return size * (document.getElementById(id).offsetWidth / 1024);
		},
		fontFamily: 'Helvetica, Arial, sans-serif',
		color: function (word, weight, fontSize, distance, theta) {
			return colors[Math.floor(Math.random() * colors.length)];
		},
		rotateRatio: 0.8, // Higher ratio for more rotated words
		rotationSteps: 12, // More rotation steps for varied angles
		backgroundColor: '#fff',
		drawOutOfBound: false,
		shuffle: true,
		shape: 'circle'
	});

}


</script>



